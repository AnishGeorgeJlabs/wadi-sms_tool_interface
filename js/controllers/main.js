// Generated by CoffeeScript 1.9.3
(function() {
  angular.module('Wadi.controllers.main', []).controller('MainCtrl', function($scope, $state, $http, $log, wdLinks, wdInterfaceApi) {
    var isLoggedIn;
    $log.debug("Main executed");
    $state.go('login');
    $scope.creds = {
      username: ''
    };
    isLoggedIn = false;
    $scope.checkLogin = function() {
      return isLoggedIn;
    };
    $scope.sheet_link = wdLinks.scheduling_sheet;
    $scope.doc_link = wdLinks.docs;
    $scope.login = function(username, pass) {
      $log.debug("Got submission " + username + ", " + pass);
      $scope.creds.username = username;
      return $http.post(wdInterfaceApi.login, {
        username: username,
        password: pass
      }).success(function(result) {
        $log.debug("Got result: " + (JSON.stringify(result)));
        isLoggedIn = result.success;
        if (isLoggedIn) {
          return $state.go('dashboard');
        } else {
          return alert("Authentication failed");
        }
      });
    };
    $scope.logout = function() {
      isLoggedIn = false;
      return $state.go('login');
    };
    $scope.isState = function(statename) {
      return $state.is(statename);
    };
    return $scope.goTo = function(statename) {
      return $state.go(statename);
    };
  }).controller('AccountDropDownCtrl', function($scope, $modal, $http, wdInterfaceApi, wdToast, $log) {
    $scope.data = {
      username: ''
    };
    return $scope.changePass = function() {
      return $modal.open({
        templateUrl: './templates/modals/modal_change_pass.html',
        resolve: {
          username: function() {
            return $scope.$parent.creds.username;
          }
        },
        controller: function($scope, $modalInstance, username) {
          $scope.data = {
            username: username,
            old_pass: '',
            new_pass: '',
            new_pass_rep: ''
          };
          return $scope.submit = function() {
            return $modalInstance.close({
              username: $scope.data.username,
              old_pass: md5($scope.data.old_pass),
              new_pass: md5($scope.data.new_pass)
            });
          };
        }
      }).result.then((function(creds) {
        return $http.post(wdInterfaceApi.change_pass, {
          username: creds.username,
          old_pass: creds.old_pass,
          new_pass: creds.new_pass
        }).success(function(data) {
          $log.debug("Got data: " + JSON.stringify(data));
          if (data.success) {
            wdToast("Password change", "The password was changed successfully, please login", "success");
            return $scope.$parent.goTo('login');
          } else {
            return wdToast("Password change", "Wrong username or password", "error");
          }
        });
      }));
    };
  }).controller('LoginCtrl', function($scope, $log) {
    $scope.data = {
      username: '',
      password: ''
    };
    return $scope.submit = function() {
      $log.debug("Submitting : " + (JSON.stringify($scope.data)));
      $scope.$parent.login($scope.data.username, md5($scope.data.password));
      $scope.data.username = '';
      return $scope.data.password = '';
    };
  }).controller('TestCtrl', function($scope, $modal, $log, wdExternalSegment) {
    return $scope.openModal = function() {
      return wdExternalSegment.new_segments(4);
    };

    /*
    $scope.openModal = () ->
      $log.debug "AccessingopenModal"
      $modal.open(
        templateUrl: 'templates/modals/modal_external_segment.html'
        backdrop: 'static'
        size: 'lg'
        keyboard: false
        resolve: {
          options: () ->
            showDetails: true
            is_new: true
            total: 14100
          segments: () -> [1,2]
        }
        controller: 'wdExternalSegmentCtrl'
      )
     */
  });

}).call(this);

//# sourceMappingURL=main.js.map
